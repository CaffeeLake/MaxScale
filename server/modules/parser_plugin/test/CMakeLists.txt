add_executable(pp_compare pp_compare.cc testreader.cc)
target_link_libraries(pp_compare maxscale-common)

add_executable(pp_convert pp_convert.cc testreader.cc)
target_link_libraries(pp_convert maxscale-common)

add_executable(pp_concurrency pp_concurrency.cc)
target_link_libraries(pp_concurrency maxscale-common)

add_executable(pp_cache pp_cache.cc)
target_link_libraries(pp_cache maxscale-common)

add_executable(pp_test pp_test.cc)
target_link_libraries(pp_test maxscale-common)

add_executable(crash_pp_sqlite crash_pp_sqlite.cc)
target_link_libraries(crash_pp_sqlite maxscale-common)

add_executable(test_pp_sqlite test_pp_sqlite.cc)
target_link_libraries(test_pp_sqlite maxscale-common)

add_test(test_crash_pp_sqlite crash_pp_sqlite)
add_test(test_pp_sqlite test_pp_sqlite)

add_test(test_pp_comparecreate            pp_test ${CMAKE_CURRENT_SOURCE_DIR}/create.pptest)
add_test(test_pp_comparedelete            pp_test ${CMAKE_CURRENT_SOURCE_DIR}/delete.pptest)
add_test(test_pp_compareinsert            pp_test ${CMAKE_CURRENT_SOURCE_DIR}/insert.pptest)
add_test(test_pp_comparejoin              pp_test ${CMAKE_CURRENT_SOURCE_DIR}/join.pptest)
add_test(test_pp_compareselect            pp_test ${CMAKE_CURRENT_SOURCE_DIR}/select.pptest)
add_test(test_pp_compareset               pp_test ${CMAKE_CURRENT_SOURCE_DIR}/set.pptest)
add_test(test_pp_compareupdate            pp_test ${CMAKE_CURRENT_SOURCE_DIR}/update.pptest)
add_test(test_pp_comparemaxscale          pp_test ${CMAKE_CURRENT_SOURCE_DIR}/maxscale.pptest)
add_test(test_pp_cte_simple               pp_test ${CMAKE_CURRENT_SOURCE_DIR}/cte_simple.pptest)
add_test(test_pp_cte_grant                pp_test ${CMAKE_CURRENT_SOURCE_DIR}/cte_grant.pptest)
add_test(test_pp_cte_nonrecursive         pp_test ${CMAKE_CURRENT_SOURCE_DIR}/cte_nonrecursive.pptest)
add_test(test_pp_cte_recursive            pp_test ${CMAKE_CURRENT_SOURCE_DIR}/cte_recursive.pptest)
add_test(test_pp_win                      pp_test ${CMAKE_CURRENT_SOURCE_DIR}/win.pptest)
add_test(test_pp_win_avg                  pp_test ${CMAKE_CURRENT_SOURCE_DIR}/win_avg.pptest)
add_test(test_pp_win_big-mdev-10092       pp_test ${CMAKE_CURRENT_SOURCE_DIR}/win_big-mdev-10092.pptest)
add_test(test_pp_win_big-mdev-11697       pp_test ${CMAKE_CURRENT_SOURCE_DIR}/win_big-mdev-11697.pptest)
add_test(test_pp_win_big                  pp_test ${CMAKE_CURRENT_SOURCE_DIR}/win_big.pptest)
add_test(test_pp_win_bit                  pp_test ${CMAKE_CURRENT_SOURCE_DIR}/win_bit.pptest)
add_test(test_pp_win_empty_over           pp_test ${CMAKE_CURRENT_SOURCE_DIR}/win_empty_over.pptest)
add_test(test_pp_win_first_last_value     pp_test ${CMAKE_CURRENT_SOURCE_DIR}/win_first_last_value.pptest)
add_test(test_pp_win_i_s                  pp_test ${CMAKE_CURRENT_SOURCE_DIR}/win_i_s.pptest)
add_test(test_pp_win_lead_lag             pp_test ${CMAKE_CURRENT_SOURCE_DIR}/win_lead_lag.pptest)
add_test(test_pp_win_min_max              pp_test ${CMAKE_CURRENT_SOURCE_DIR}/win_min_max.pptest)
add_test(test_pp_win_nth_value            pp_test ${CMAKE_CURRENT_SOURCE_DIR}/win_nth_value.pptest)
add_test(test_pp_win_ntile                pp_test ${CMAKE_CURRENT_SOURCE_DIR}/win_ntile.pptest)
add_test(test_pp_win_orderby              pp_test ${CMAKE_CURRENT_SOURCE_DIR}/win_orderby.pptest)
add_test(test_pp_win_percent_cume         pp_test ${CMAKE_CURRENT_SOURCE_DIR}/win_percent_cume.pptest)
add_test(test_pp_win_rank                 pp_test ${CMAKE_CURRENT_SOURCE_DIR}/win_rank.pptest)
add_test(test_pp_win_std                  pp_test ${CMAKE_CURRENT_SOURCE_DIR}/win_std.pptest)
add_test(test_pp_win_sum                  pp_test ${CMAKE_CURRENT_SOURCE_DIR}/win_sum.pptest)
add_test(test_pp_oracle-binlog_stm_ps     pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/binlog_stm_ps.pptest)
add_test(test_pp_oracle-binlog_stm_sp     pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/binlog_stm_sp.pptest)
add_test(test_pp_oracle-exception         pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/exception.pptest)
add_test(test_pp_oracle-func_case         pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/func_case.pptest)
add_test(test_pp_oracle-func_concat       pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/func_concat.pptest)
add_test(test_pp_oracle-func_decode       pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/func_decode.pptest)
add_test(test_pp_oracle-func_length       pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/func_length.pptest)
add_test(test_pp_oracle-func_misc         pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/func_misc.pptest)
add_test(test_pp_oracle-misc              pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/misc.pptest)
add_test(test_pp_oracle-ps                pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/ps.pptest)
add_test(test_pp_oracle-sequence          pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/sequence.pptest)
add_test(test_pp_oracle-sp-anonymous      pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/sp-anonymous.pptest)
add_test(test_pp_oracle-sp-code           pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/sp-code.pptest)
add_test(test_pp_oracle-sp-cursor-decl    pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/sp-cursor-decl.pptest)
add_test(test_pp_oracle-sp-cursor-rowtype pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/sp-cursor-rowtype.pptest)
add_test(test_pp_oracle-sp-cursor         pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/sp-cursor.pptest)
add_test(test_pp_oracle-sp-goto           pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/sp-goto.pptest)
add_test(test_pp_oracle-sp-param          pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/sp-param.pptest)
add_test(test_pp_oracle-sp-row            pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/sp-row.pptest)
add_test(test_pp_oracle-sp-security       pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/sp-security.pptest)
add_test(test_pp_oracle-sp                pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/sp.pptest)
add_test(test_pp_oracle-trigger           pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/trigger.pptest)
add_test(test_pp_oracle-truncate          pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/truncate.pptest)
add_test(test_pp_oracle-type_blob         pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/type_blob.pptest)
add_test(test_pp_oracle-type_clob         pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/type_clob.pptest)
add_test(test_pp_oracle-type_date         pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/type_date.pptest)
add_test(test_pp_oracle-type_number       pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/type_number.pptest)
add_test(test_pp_oracle-type_raw          pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/type_raw.pptest)
add_test(test_pp_oracle-type_varchar      pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/type_varchar.pptest)
add_test(test_pp_oracle-type_varchar2     pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/type_varchar2.pptest)
add_test(test_pp_oracle-type_variables    pp_test ${CMAKE_CURRENT_SOURCE_DIR}/oracle/variables.pptest)

if (BUILD_POSTGRES)
  target_link_libraries(compare postgresprotocol)
  target_compile_definitions(compare PRIVATE -DBUILD_POSTGRES=1)

  file(GLOB POSTGRES_TEST_FILES ${CMAKE_CURRENT_SOURCE_DIR}/postgres/*.sql)

  # From all files in the directory, pick statements that match the regex "^ALTER TABLE "
  # and check that the output for "operation" matches the regex "OP_ALTER_TABLE".
  add_test(pg_alter_table pp_compare -v 3 -0 pp_pg_query -E postgres -x "^ALTER TABLE " -p operation -c "ALTER_TABLE" ${POSTGRES_TEST_FILES})
  add_test(pg_alter pp_compare -v 3 -0 pp_pg_query -E postgres -x "^ALTER" -p operation -c "ALTER" ${POSTGRES_TEST_FILES})

  add_test(pg_create_table pp_compare -v 3 -0 pp_pg_query -E postgres -x "^CREATE TABLE " -p operation -c "CREATE_TABLE" ${POSTGRES_TEST_FILES})
  add_test(pg_create pp_compare -v 3 -0 pp_pg_query -E postgres -x "^CREATE" -p operation -c "CREATE" ${POSTGRES_TEST_FILES})

  add_test(pg_drop_table pp_compare -v 3 -0 pp_pg_query -E postgres -x "^DROP TABLE " -p operation -c "DROP_TABLE" ${POSTGRES_TEST_FILES})
  add_test(pg_drop pp_compare -v 3 -0 pp_pg_query -E postgres -x "^DROP" -p operation -c "DROP" ${POSTGRES_TEST_FILES})

endif()
